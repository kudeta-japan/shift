<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>KU-DETA シフト提出</title>
  <style>
    body{font-family:system-ui;padding:2rem;line-height:1.6;}
    h2{margin-bottom:1.2rem;}
    label{display:block;margin-top:1rem;}
    select,input{padding:.6rem;border:1px solid #ccc;border-radius:6px;width:100%;max-width:320px;}
    button{margin-top:1.5rem;padding:.7rem 2rem;border:none;border-radius:6px;background:#333;color:#fff;cursor:pointer;font-size:1rem;}
    button:disabled{opacity:.6;cursor:not-allowed;}
    #msg{margin-top:1.2rem;font-weight:bold;}
  </style>
</head>
<body>
  <h2>KU-DETA シフト提出</h2>

  <label>シフト区分
    <select id="shiftType">
      <option value="LUNCH">ランチ</option>
      <option value="DINNER">ディナー</option>
    </select>
  </label>

  <label>名前
    <select id="name"></select>
  </label>

  <label>勤務希望日 (例: 1,3,5)
    <input id="days" placeholder="半角カンマ区切り">
  </label>

  <button id="sendBtn">送信</button>
  <p id="msg"></p>

<script>
/* ======= 設定 ======= */
const ENDPOINT = 'hhttps://script.google.com/macros/s/AKfycbygPABXDHIPT0HszOewnDlkThAGJkcONaaglK4U7oDwYpnpLuSwJoqrUe2qK_pBu33zmw/exec'; // ← /exec URL に置換
const SECRET   = 'shift2025';                                               // ← Code.gs と同じキー

/* ======= スタッフ一覧 ======= */
const STAFF = {
  LUNCH: ['佐々木裕哉','久納真希','小木曽公亮','園田響','古野御音','佐野真央','塚本千紘','佐々木蒼空','辻華穂','山本百葉','中村夏子','長屋和磨','益田瑞基','山田彩乃','岡安梨沙','佐々木美紅'],
  DINNER:['佐々木裕哉','久納真希','小木曽公亮','園田響','古野御音','佐野真央','佐々木蒼空','辻華穂','山本百葉','長屋和磨','益田瑞基','山田彩乃','岡安梨沙']
};

/* ======= UI 初期化 ======= */
const typeSel = document.getElementById('shiftType');
const nameSel = document.getElementById('name');
const daysInp = document.getElementById('days');
const msgElm  = document.getElementById('msg');
const btn     = document.getElementById('sendBtn');

function populateNames(){
  nameSel.innerHTML = '';
  STAFF[typeSel.value].forEach(n=>{
    const opt = document.createElement('option');
    opt.value = opt.textContent = n;
    nameSel.appendChild(opt);
  });
}
typeSel.onchange = populateNames;
populateNames();

/* ======= 送信処理 ======= */
btn.onclick = async ()=>{
  const data = {
    name      : nameSel.value,
    shiftType : typeSel.value,
    days      : daysInp.value.split(',').map(s=>Number(s.trim())).filter(Boolean)
  };
  if(!data.name || data.days.length === 0){
    alert('名前と勤務希望日を入力してください');return;
  }

  btn.disabled = true;
  msgElm.textContent = '送信中…';

  try{
    const res  = await fetch(ENDPOINT,{
      method : 'POST',
      headers: {'Content-Type':'text/plain'},      // ここ重要
      body   : JSON.stringify({key: SECRET, data})
    });
    const text = await res.text();
    if(res.ok && text === 'OK'){
      msgElm.textContent = '送信しました ✔︎';
      daysInp.value = '';
    }else{
      msgElm.textContent = 'エラー: ' + text;
    }
  }catch(err){
    msgElm.textContent = '通信エラー';
  }finally{
    btn.disabled = false;
  }
};
</script>
</body>
</html>
